# 错误处理说明

## 502 Bad Gateway 错误处理

### 问题分析

**502 Bad Gateway** 是服务器端错误，通常表示：
- 服务器过载或临时故障
- 网关服务器无法从上游服务器获取有效响应
- 网络连接问题

### 解决方案

脚本已实现以下优化来处理502错误：

#### 1. **智能重试机制**
- 默认重试5次（之前是3次）
- 使用**指数退避策略**：等待时间递增（2秒、4秒、8秒...最多30秒）
- 区分不同类型的错误，采用不同的处理策略

#### 2. **自适应延迟**
- 遇到连续502错误时，自动增加请求间隔
- 每3次连续错误，延迟增加0.5秒（最多增加到5秒）
- 成功请求后，延迟逐渐恢复

#### 3. **错误分类统计**
- **页面获取失败**：502、503等服务器错误
- **内容为空**：页面获取成功但内容提取失败
- **内容过短**：内容提取成功但长度不足

#### 4. **详细错误报告**
爬取完成后会显示：
- 成功/失败统计
- 错误类型分布
- 失败章节列表（最多显示5个）
- 平均爬取速度

### 使用建议

1. **遇到502错误时**：
   - 脚本会自动重试，无需手动干预
   - 如果连续失败，延迟会自动增加
   - 可以等待一段时间后重新运行（支持断点续传）

2. **提高成功率**：
   - 可以手动增加初始延迟：修改代码中的 `delay=1.0` 为更大的值（如 `delay=2.0`）
   - 避免在网络高峰期运行

3. **处理失败的章节**：
   - 失败的章节会在最终报告中列出
   - 可以重新运行脚本，脚本会尝试重新爬取失败的章节
   - 或者手动访问失败的章节URL进行验证

### 错误处理流程

```
请求章节
  ↓
成功？ → 是 → 提取内容 → 完成
  ↓ 否
检查错误类型
  ↓
502/503等服务器错误？
  → 是 → 等待（指数退避）→ 重试（最多5次）
  → 否 → 404等 → 记录失败
  ↓
所有重试失败 → 记录到失败列表
  ↓
继续下一章
```

### 技术细节

- **超时时间**：20秒（之前是15秒）
- **重试次数**：5次（之前是3次）
- **最大等待时间**：30秒
- **自适应延迟上限**：5秒

### 常见问题

**Q: 为什么有些章节一直失败？**
A: 可能是服务器临时故障或该章节URL有问题。可以：
- 等待一段时间后重新运行
- 手动访问URL检查是否可访问
- 检查网络连接

**Q: 可以跳过失败的章节吗？**
A: 可以。脚本会继续爬取其他章节，失败的章节会在最后报告中列出。

**Q: 如何提高成功率？**
A: 
- 增加初始延迟时间
- 在网络稳定时运行
- 避免同时运行多个爬虫实例

